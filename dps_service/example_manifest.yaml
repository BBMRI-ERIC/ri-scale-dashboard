# yaml
manifest_id: "id2025-11-13"
created_by: "user@example.org"
created_at: "2025-11-13T10:00:00Z"

simulated: true

job_steps:
  - step_name: load wsi data          # data loading example
    type: load
    enabled: true
    params:
      output_source_name: source1
      mode: "discovery"
      path: "./data/wsi"
      include: "*.svs"
      recursive: false
      directory_mode: false
      columns:
        column_name: "wsi_path"
        filename_to_columnname: "^(?P<slide_id>.+?)(?=\\.svs$)"

  - step_name: load labels csv data          # data loading example
    type: load
    enabled: true
    params:
      output_source_name: source2
      mode: "csv_file"
      path: "./data/labels.csv"
      columns:
        header: true
        delimiter: ","

  - step_name: delete existing dicom output folder
    type: custom_command
    enabled: true
    params:
      execution_mode: "once"
      command: "rm -rf ./data/dicom_dicomizer" 

  - step_name: create dicom output folder
    type: custom_command
    enabled: true
    params:
      execution_mode: "once"
      command: "mkdir -p ./data/dicom_dicomizer"

  - step_name: convert wsi to dicom              # basic command call example
    type: custom_command
    enabled: true
    params:
      input_source_name: source1
      execution_mode: "per_row"
      command: "wsidicomizer -i {wsi_path} -o ./data/dicom_dicomizer/{slide_id} --source opentile --format jpeg --quality 100"

  - step_name: load dicom output
    type: load
    enabled: true
    params:
      output_source_name: source3_dicom
      mode: discovery
      path: "./data/dicom_dicomizer"
      include: "*"
      recursive: false
      directory_mode: true
      columns:
        column_name: "dicom_path"
        filename_to_columnname: "^(?P<slide_id>.+)$"

  - step_name: join results                        # data merge example
    type: join
    enabled: true
    params:
      left_source_name: source1
      right_source_name: source2
      output_source_name: source1_source2_joined
      left_key: slide_id
      right_key: slide_id
      join_type: inner
      missing_policy: drop

  - step_name: join results dicom
    type: join
    enabled: true
    params:
      left_source_name: source1_source2_joined
      right_source_name: source3_dicom
      output_source_name: final_output
      left_key: slide_id
      right_key: slide_id
      join_type: inner
      missing_policy: drop